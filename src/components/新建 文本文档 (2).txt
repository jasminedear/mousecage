<!-- æ­»äº¡é€»è¾‘ -->
@record-death-clicked="handleRecordDeathClicked"

function handleRecordDeathClicked(payload) {
  const { mouse, event } = payload;
  // âš ï¸ ç¡®è®¤ MouseCard.vue emit çš„ payload åŒ…å« eventï¼Œå¦åˆ™ getBoundingClientRect() ä¼šæŠ¥é”™
  currentMouseId.value = mouse.id;
  ...
}
vue
å¤åˆ¶ä»£ç 
<!-- ç§»åŠ¨è€é¼ é€»è¾‘ -->
@move="openMoveMouse"

function openMoveMouse(mouse) {
  movingMouse.value = mouse;
  showMoveMouse.value = true;
}

<!-- âš ï¸ é—®é¢˜ï¼šè¿™é‡Œåªæ˜¯æ‰“å¼€å¼¹çª—ï¼Œæ²¡æœ‰æ›´æ–° store -->
<!-- å»ºè®®ï¼šåœ¨ MoveMouseModal ç¡®è®¤æ—¶è°ƒç”¨ -->
miceStore.updateMouse(mouse.id, { cageId: newCageId });
vue
å¤åˆ¶ä»£ç 
// å¯¼å…¥é€»è¾‘
async function handleImport(e) {
  const file = e.target.files[0];
  if (!file) return;
  try {
    const data = await importFile(file);
    data.forEach((item) => {
      if (item.type === "cage") {
        miceStore.addCage(item);
      } else if (item.type === "mouse") {
        // âš ï¸ å»ºè®®ï¼šåœ¨å¯¼å…¥ mouse æ—¶å…ˆæ£€æŸ¥ cageId æ˜¯å¦å­˜åœ¨
        if (item.cageId && miceStore.cages.some(c => c.id === item.cageId)) {
          miceStore.addMouse(item);
        } else {
          console.warn("å¯¼å…¥å¤±è´¥ï¼šç¬¼ä½ä¸å­˜åœ¨", item);
        }
      }
    });
    ...
  }
}
ğŸŸ¡ æ€»ç»“
åˆ é™¤ vs æ­»äº¡ â†’ æ–‡æ¡ˆä¸Šæ˜ç¡®åŒºåˆ†ï¼Œé¿å…è¯¯åˆ ã€‚

æ­»äº¡è®°å½• â†’ ç¡®è®¤ MouseCard emit çš„ payload æœ‰ eventã€‚

ç§»åŠ¨è€é¼  â†’ å¼¹çª—ç¡®è®¤åå¿…é¡»è°ƒç”¨ miceStore.updateMouseã€‚

å¯¼å…¥åŠŸèƒ½ â†’ åŠ ä¸€å±‚æ ¡éªŒï¼Œé¿å…æ‚¬ç©ºè€é¼ ã€‚

è¿™æ ·æ”¹å®Œåï¼š

mice.js çš„æ ¸å¿ƒé€»è¾‘å®Œå…¨ä¸åŠ¨ã€‚

CageGrid çš„äº¤äº’æ›´æ¸…æ™°ï¼Œæ•°æ®ä¸€è‡´æ€§æ›´å¼ºã€‚



å¥½ä¸»æ„ ğŸ‘
æˆ‘å¸®ä½ æ•´ç†ä¸€ä»½ **Tips æ¸…å•**ï¼Œç”¨æ¥å›ºå®šâ€œçº¦å®šä¿—æˆâ€çš„å¼•ç”¨æ–¹å¼å’Œå‘½åè§„èŒƒã€‚ä»¥åå¦‚æœä½ è§‰å¾—æˆ‘æœ‰ç‚¹æ··ä¹±ï¼Œä½ åªè¦æŠŠè¿™ä»½ Tips å‘ç»™æˆ‘ï¼Œæˆ‘å°±èƒ½å¿«é€Ÿæ¢å¤ä¸Šä¸‹æ–‡ã€‚

---

# ğŸ­ é¼ ç¬¼ç®¡ç†ç³»ç»Ÿ Tips

## ä¸€ã€Storeï¼ˆmice.jsï¼‰

* **å¯¼å…¥**ï¼š

  ```js
  import { useMiceStore } from "@/stores/mice"
  const miceStore = useMiceStore()
  ```
* **æ ¸å¿ƒ state**ï¼š

  * `cages`ï¼šç¬¼ä½æ•°ç»„
  * `mice`ï¼šæ´»ä½“è€é¼ 
  * `deadMice`ï¼šæ­»äº¡è€é¼ 
  * `records`ï¼šæ—¥å¿—
  * `breeding`ï¼šç¹è‚²ä¿¡æ¯
* **å¸¸ç”¨ getters**ï¼š

  * `normalizedMice` â†’ ä¿è¯ sex å§‹ç»ˆä¸º `"male"|"female"|"normal"`
  * `allGenotypes` â†’ æ‰€æœ‰åŸºå› å‹ï¼ˆå»é‡ï¼‰
* **å¸¸ç”¨ actions**ï¼š

  * `addCage(cage)` / `deleteCage(cageId)` / `deleteRow(rowName)`
  * `addMouse(mouse)` / `deleteMouse(mouseId)` / `updateMouse(id, fields)`
  * `recordDeath(mouseId, cause)` / `deleteDeadMouse(id)` / `clearAllDeadMice()`
  * `renameRow(oldName, newName)`
  * `saveToCloud({silent})` / `loadFromCloud()`
  * `getCageName(cageId)`

---

## äºŒã€CageGrid.vue

* **æ•°æ®è¯»å–**

  * ä¸€å®šè¦ç”¨ `miceStore.normalizedMice` æ¸²æŸ“è€é¼ 
  * æ¸²æŸ“ç¬¼ä½åè¦ç”¨ `miceStore.getCageName(mouse.cageId)`
* **äº‹ä»¶è°ƒç”¨**

  * åˆ é™¤ç¬¼å­ï¼š`miceStore.deleteCage(cageId)`
  * åˆ é™¤è€é¼ ï¼ˆå½»åº•ï¼‰ï¼š`miceStore.deleteMouse(mouseId)`
  * æ ‡è®°æ­»äº¡ï¼š`miceStore.recordDeath(mouseId, cause)`
  * ç§»åŠ¨è€é¼ ï¼š`miceStore.updateMouse(mouse.id, { cageId: newCageId })`ï¼ˆåœ¨ MoveMouseModal ç¡®è®¤æ—¶è°ƒç”¨ï¼‰
* **ç­›é€‰å™¨**

  * æ€§åˆ«ï¼š`male` / `female`
  * åŸºå› å‹ï¼š`miceStore.allGenotypes`
  * ç‰¹æ®ŠçŠ¶æ€ï¼š`mouse.statuses` é‡Œæœ‰ `"å¹¼é¼ "` / `"æ€€å­•"`

---

## ä¸‰ã€MouseCard.vue

* å¿…é¡» emit çš„äº‹ä»¶ï¼š

  * `@view="openDetail"`
  * `@move="openMoveMouse"`
  * `@delete="deleteMouse"`
  * `@record-death-clicked="handleRecordDeathClicked"` â†’ âš ï¸ payload å¿…é¡»åŒ…å« `{ mouse, event }`

---

## å››ã€å‘½åè§„èŒƒ

* **æ€§åˆ«**ï¼šç»Ÿä¸€ä¸º `"male"` / `"female"`ï¼ˆUI å±‚å¯ä»¥æ˜¾ç¤º `â™‚` / `â™€`ï¼‰
* **æ—¶é—´**ï¼šç›®å‰ç”¨ `new Date().toLocaleString()`ï¼ˆå¯æ”¹ ISOï¼Œä½†å…ˆä¿æŒä¸€è‡´ï¼‰
* **id**ï¼šå…¨éƒ¨ç”¨ `generateShortId()` ç”Ÿæˆï¼Œé¿å…å†²çª
* **çŠ¶æ€ï¼ˆstatusesï¼‰**ï¼šå¯åŒ…å« `"å¹¼é¼ "|"æ€€å­•"|"å“ºä¹³"` ç­‰ä¸­æ–‡å­—ç¬¦ä¸²

---

## äº”ã€æœ€ä½³å®è·µ

* **åˆ é™¤ vs æ­»äº¡**

  * åˆ é™¤ â†’ æµ‹è¯•/è¯¯åŠ æ—¶ä½¿ç”¨ï¼Œä¸ç•™è®°å½•
  * æ­»äº¡ â†’ ç”Ÿäº§ä¸­ä½¿ç”¨ï¼Œä¿ç•™åœ¨ `deadMice`ï¼Œå¿…é¡»é€‰æ‹©/è¾“å…¥æ­»äº¡åŸå› 
* **å¯¼å…¥**

  * å…ˆæ ¡éªŒ `cageId` æ˜¯å¦å­˜åœ¨ï¼Œå† `miceStore.addMouse(item)`
* **è‡ªåŠ¨ä¿å­˜**

  * ä½¿ç”¨ `miceStore.saveToCloud({ silent: true })`ï¼Œé¿å…å†™æ—¥å¿—æ­»å¾ªç¯

---

è¿™æ ·ä¸€ä»½ Tips å¯ä»¥ä¿è¯æˆ‘ä»¬ä»¥åæ²Ÿé€šæ—¶ä¸ä¼šä¹±æ‰ã€‚
è¦ä¸è¦æˆ‘å¸®ä½ å†å†™ä¸€ä¸ª **ç®€åŒ–ç‰ˆï¼ˆ10 è¡Œå·¦å³ï¼‰**ï¼Œä¸“é—¨ç»™ä½ å¿«é€Ÿè´´å‡ºæ¥å½“â€œè®°å¿†æ¢å¤é”®â€ï¼Ÿ
